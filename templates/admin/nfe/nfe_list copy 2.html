  {% extends "layout_admin.html" %}

  {% block content %}

  {% include 'navbar_admin.html' %}
  <div class="container mt-4">
      <div class="d-flex justify-content-between align-items-center mt-4 mb-3">
      <h3>{{ titulo }}</h3>
      <div>
          <a href="{{ url_for('nfe_bp.xml_list') }}" class="btn btn-info me-2">
              <i class="bi bi-file-earmark-code"></i> Gerenciar XMLs
          </a>
          <a href="{{ url_for('nfe_bp.nfe_create') }}" class="btn btn-success">
              <i class="bi bi-plus-circle"></i> Nova Nota Fiscal
          </a>
      </div>
      </div>
      <hr>
    {% if notas %}
      <table class="table table-striped">
        <thead>
          <tr>
            <th>#</th>
            <th>Data</th>
            <th>Número</th>
            <th>Cliente</th>
            <th>Valor</th>
            <th>Status</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for nota in notas %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ nota.issue_date.strftime('%d/%m/%Y %H:%M') }}</td>
            <td>{{ nota.number }}</td>
            <td>{{ nota.client.name }}</td>
            <td>R$ {{ "%.2f"|format(nota.total_value)|replace('.', ',') }}</td>
            <td>{{ nota.status }}</td>
            <td>
              <a href="{{ url_for('nfe_bp.nfe_detail', id=nota.id) }}" class="btn btn-sm btn-primary">
                Espelho NFCe (65)
              </a>

              <a href="{{ url_for('nfe_bp.gerar_xml_nfce', id=nota.id) }}" class="btn btn-sm btn-warning">
                XML NFC-e 
              </a>

              <a href="{{ url_for('nfe_bp.generate_xml_signed', id=nota.id) }}"
                class="btn btn-sm btn-outline-success">
                XML Assinado (Debug)
              </a>

              <a href="{{ url_for('nfe_bp.transmit_nfe', id=nota.id) }}"
                class="btn btn-sm btn-primary"
                onclick="return confirm('Deseja realmente transmitir esta NFC-e para a SEFAZ?');">
                  <i class="fas fa-paper-plane"></i> Transmitir
              </a>

              {% if nota.nrec %}
                <a href="{{ url_for('nfe_bp.consultar_recibo', id=nota.id) }}" 
                  class="btn btn-sm btn-info">
                  <i class="bi bi-search"></i> Consultar Recibo
                </a>
              {% else %}
                <button class="btn btn-sm btn-secondary" disabled>
                  <i class="bi bi-search"></i> Sem Recibo
                </button>
              {% endif %}

            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="alert alert-info">Nenhuma nota fiscal emitida ainda.</div>
    {% endif %}
  </div>
  {% endblock %}